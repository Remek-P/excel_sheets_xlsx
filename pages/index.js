import {useRef, useState} from "react";

import Head from "next/head";
import Input from "@/components/input/input";
import Output from "@/components/output/output";

import XLSX from "xlsx";

export default function Home() {

  const [excelFileName, setExcelFileName] = useState(null);
  const [excelFile, setExcelFile] = useState(null);

  const clickRef = useRef(null);

  const handleFile = async (e) => {

    setExcelFile(null);
    setExcelFileName(e.target.files[0].name);
    const excelFile = e.target.files[0];
    const data = await excelFile.arrayBuffer();

    const workbook = XLSX.readFile(data, { sheetRows: 10 + 1 })

    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
    const jsonData = XLSX.utils.sheet_to_json(worksheet, {
      header: 1,
      defval: "",
    })

    setExcelFile(jsonData);
  }

  console.log("Home")
  return (
    <>
      <Head>
        <title>EXCEL to JS</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <h1>Chose a file</h1>
        <div style={{display: "flex", flexDirection: "column"}}>
          <Input type="file"
                 id="filepicker"
                 onChange={handleFile}
                 accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, .xlsx, .xls"
                 children={"Upload"}
                 isFileNameVisible={true}
                 fileName={excelFileName}
                 excelFile={excelFile}
                 clickRef={clickRef}
          />
          {excelFile && <Output excelFile={excelFile}/>}
        </div>
      </main>
    </>
  );
}
